[gd_scene load_steps=5 format=3 uid="uid://c3otevrfkc37e"]

[ext_resource type="Texture2D" uid="uid://dnglnku28v7oy" path="res://Images/icon.svg" id="1_mxk4j"]

[sub_resource type="GDScript" id="GDScript_18544"]
resource_name = "Player"
script/source = "extends Node2D

@export var color : Color

# vid kollision
func _on_area_2d_body_entered(body):
	print(body.get_parent().default_color)
"

[sub_resource type="GDScript" id="GDScript_wdbpk"]
resource_name = "Script"
script/source = "extends Node

var ang = 0
var speed = 500

const lineScene = preload(\"res://Instances/CollisionLine.tscn\")

# Called when the node enters the scene tree for the first time.
func _ready():
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	handle_input()
	
	var prevpos = get_owner().position
	get_owner().position.x += delta*speed*cos(ang)
	get_owner().position.y += delta*speed*(-sin(ang))
	add_line(prevpos, get_owner().position)

func add_line(pos1, pos2):
	var collisionLine = lineScene.instantiate()
	collisionLine.color = get_owner().color
	var line = collisionLine.get_node(\"Line2D\")
	line.points = [pos1, pos2]
	add_child(collisionLine)

func handle_input():
	var color = get_owner().color
	var left : bool
	var right : bool
	var up : bool
	var down : bool
	if (color == Color.BLUE):
		left = Input.is_action_pressed(\"P1left\")
		right = Input.is_action_pressed(\"P1right\")
		up = Input.is_action_pressed(\"P1up\")
		down = Input.is_action_pressed(\"P1down\")
	if (color == Color.RED):
		left = Input.is_action_pressed(\"P2left\")
		right = Input.is_action_pressed(\"P2right\")
		up = Input.is_action_pressed(\"P2up\")
		down = Input.is_action_pressed(\"P2down\")
	
	var minang = PI/4
		
	if left:
		ang = 4*minang
	if right:
		ang = 0*minang
	if up:
		ang = 2*minang
	if down:
		ang = -2*minang
	
	if left and up:
		ang = 3*minang
	if right and up:
		ang = 1*minang
	if left and down:
		ang = -3*minang
	if right and down:
		ang = -1*minang
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_xlvm6"]
size = Vector2(119, 120)

[node name="Player" type="Node2D"]
script = SubResource("GDScript_18544")
color = Color(0, 0, 1, 1)

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_mxk4j")

[node name="Script" type="Node" parent="."]
script = SubResource("GDScript_wdbpk")

[node name="Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
position = Vector2(-0.5, -1)
shape = SubResource("RectangleShape2D_xlvm6")

[connection signal="body_entered" from="Area2D" to="." method="_on_area_2d_body_entered"]
